<!DOMTYPE html>
  <style>
.textbox{
   font-family: monospace;
}
</style>
  <header>
    <title>websocket-example.html</title>
  </header>
<body>
  <br/>
  <div class="textbox" id="websocket-example">
    Hi there
  </div>
</body>
<script>

let apr = "ws://localhost:12345";
let socket = new WebSocket(apr);
let msgBox = document.getElementById("websocket-example");
var pingerid;

function ping_ws() {
    if (socket.readyState == 1) {
	socket.send("Heartbeat");
    }
}

function shutdown_ws() {
    if (socket != null) {
	socket.onerror = null;
	socket.onclose = null;
	socket.close ();
	socket = null;
    }
    msgBox.textContent = "shutdown"
    clearInterval (pingerid);
}

socket.onopen = function(e) {
    console.log("[open] Connection established");
    pingerid = setInterval (function () {ping_ws();}, 40000);
}

socket.onmessage = function(event) {
	<!-- console.log(`[message] Data received from server: ${event.data}`); -->
	msgBox.textContent = `${event.data}`;
};

socket.onclose = function(event) {
    if (event.wasClean) {
	console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
    }
    else {
	// e.g. server process killed or network down // event.code is usually 1006 in this case
	console.log('[close] Connection died');
    }
    shutdown_ws();
};

socket.onerror = function(error) {
      console.log(`[error] ${error.message}`);
};

</script>
</html>
